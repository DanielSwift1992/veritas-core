#!/usr/bin/env bash
# Local git pre-commit hook: abort commit if build or tests fail.
# Usage (one time):
#   chmod +x scripts/pre-commit
#   ln -sf ../../scripts/pre-commit .git/hooks/pre-commit
# Now every commit will run ./build.sh before persisting.

set -euo pipefail

echo "[pre-commit] Running local build (skip Lean if not installed)â€¦"
./build.sh --skip-lean > /dev/null 2>&1 || {
  echo "[pre-commit] Build failed. Commit aborted." >&2
  exit 1
}

# Abort if README.md or whole.lock changed but not staged
if ! git diff --quiet -- README.md whole.lock; then
  echo "[pre-commit] README.md or whole.lock modified by build. Please 'git add' them and re-commit." >&2
  exit 1
fi

echo "[pre-commit] Build succeeded. Proceeding with commit." 